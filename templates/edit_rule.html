<!-- templates/edit_rule.html -->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Edit Rule</title>
</head>
<body>
    <h1>Edit Rule</h1>
    <form action="{{ url_for('edit_rule', rule_id=rule['_id']) }}" method="POST">
        <label for="category">Category:</label>
        <input type="text" id="category" name="category" value="{{ rule.category }}" required><br><br>
        <label for="disease_name">Disease Name:</label>
        <input type="text" id="disease_name" name="disease_name" value="{{ rule.disease_name }}" required><br><br>
        <label for="disease_code">Disease Code:</label>
        <input type="text" id="disease_code" name="disease_code" value="{{ rule.disease_code }}" required><br><br>

        <!-- Add fields for rules and conditions here -->
        {% for rule_entry in rule.rules %}
            <div class="rule-entry">
                <h3>Rule {{ loop.index }}</h3>
                {% for condition in rule_entry.conditions %}
                    <div class="condition">
                        <label for="conditions[{{ loop.parentloop.index }}][{{ loop.index }}]">Condition Type:</label>
                        <input type="text" id="conditions[{{ loop.parentloop.index }}][{{ loop.index }}]" name="conditions[{{ loop.parentloop.index }}][]" value="{{ condition.type }}" required><br><br>

                        <label for="parameters[{{ loop.parentloop.index }}][{{ loop.index }}]">Parameter:</label>
                        <input type="text" id="parameters[{{ loop.parentloop.index }}][{{ loop.index }}]" name="parameters[{{ loop.parentloop.index }}][]" value="{{ condition.parameter }}" required><br><br>

                        <label for="units[{{ loop.parentloop.index }}][{{ loop.index }}]">Unit:</label>
                        <input type="text" id="units[{{ loop.parentloop.index }}][{{ loop.index }}]" name="units[{{ loop.parentloop.index }}][]" value="{{ condition.unit }}" required><br><br>

                        <label for="age_min[{{ loop.parentloop.index }}][{{ loop.index }}]">Age Min:</label>
                        <input type="number" id="age_min[{{ loop.parentloop.index }}][{{ loop.index }}]" name="age_min[{{ loop.parentloop.index }}][]" value="{{ condition.age_min }}" required><br><br>

                        <label for="age_max[{{ loop.parentloop.index }}][{{ loop.index }}]">Age Max:</label>
                        <input type="number" id="age_max[{{ loop.parentloop.index }}][{{ loop.index }}]" name="age_max[{{ loop.parentloop.index }}][]" value="{{ condition.age_max }}" required><br><br>

                        <label for="genders[{{ loop.parentloop.index }}][{{ loop.index }}]">Gender:</label>
                        <input type="text" id="genders[{{ loop.parentloop.index }}][{{ loop.index }}]" name="genders[{{ loop.parentloop.index }}][]" value="{{ condition.gender }}" required><br><br>

                        {% if condition.type == 'range' %}
                            <label for="min_values[{{ loop.parentloop.index }}][{{ loop.index }}]">Min Value:</label>
                            <input type="number" id="min_values[{{ loop.parentloop.index }}][{{ loop.index }}]" name="min_values[{{ loop.parentloop.index }}][]" value="{{ condition.min_value }}" required><br><br>

                            <label for="max_values[{{ loop.parentloop.index }}][{{ loop.index }}]">Max Value:</label>
                            <input type="number" id="max_values[{{ loop.parentloop.index }}][{{ loop.index }}]" name="max_values[{{ loop.parentloop.index }}][]" value="{{ condition.max_value }}" required><br><br>
                        {% elif condition.type == 'comparison' %}
                            <label for="operators[{{ loop.parentloop.index }}][{{ loop.index }}]">Operator:</label>
                            <input type="text" id="operators[{{ loop.parentloop.index }}][{{ loop.index }}]" name="operators[{{ loop.parentloop.index }}][]" value="{{ condition.operator }}" required><br><br>

                            <label for="comparison_values[{{ loop.parentloop.index }}][{{ loop.index }}]">Comparison Value:</label>
                            <input type="number" id="comparison_values[{{ loop.parentloop.index }}][{{ loop.index }}]" name="comparison_values[{{ loop.parentloop.index }}][]" value="{{ condition.comparison_value }}" required><br><br>
                        {% elif condition.type == 'time-dependent' %}
                            <label for="operators[{{ loop.parentloop.index }}][{{ loop.index }}]">Operator:</label>
                            <input type="text" id="operators[{{ loop.parentloop.index }}][{{ loop.index }}]" name="operators[{{ loop.parentloop.index }}][]" value="{{ condition.operator }}" required><br><br>

                            <label for="comparison_time_values[{{ loop.parentloop.index }}][{{ loop.index }}]">Comparison Time Value:</label>
                            <input type="number" id="comparison_time_values[{{ loop.parentloop.index }}][{{ loop.index }}]" name="comparison_time_values[{{ loop.parentloop.index }}][]" value="{{ condition.comparison_time_value }}" required><br><br>

                            <label for="time_values[{{ loop.parentloop.index }}][{{ loop.index }}]">Time:</label>
                            <input type="text" id="time_values[{{ loop.parentloop.index }}][{{ loop.index }}]" name="time_values[{{ loop.parentloop.index }}][]" value="{{ condition.time }}" required><br><br>
                        {% endif %}
                    </div>
                {% endfor %}
            </div>
        {% endfor %}

        <button type="submit">Update Rule</button>
    </form>
</body>
</html>